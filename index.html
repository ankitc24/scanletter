<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Letter Name & Pincode Reader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body { font-family: Arial, sans-serif; padding: 10px; }
video { width: 100%; border: 2px solid black; }
button { width: 100%; padding: 10px; margin-top: 6px; font-size: 16px; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid black; padding: 8px; text-align: center; }
th { background-color: #f2f2f2; }
</style>
</head>

<body>

<h3>üìÑ Letter Scanner (English Name after ‚Äú‡§™‡•ç‡§∞‡§§‡§ø,‚Äù)</h3>

<video id="video" autoplay playsinline muted></video>

<button onclick="startCamera()">Start Camera</button>
<button onclick="scanLetter()">Scan Letter</button>

<table>
<thead>
<tr>
    <th>Sl No</th>
    <th>Name (2 words)</th>
    <th>Pincode</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<canvas id="canvas" style="display:none;"></canvas>

<script>
let slNo = 1;
let stream = null;
const video = document.getElementById("video");

// Start camera
async function startCamera() {
    stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
    });
    video.srcObject = stream;
    await video.play();
}

// OCR scan
function scanLetter() {
    if (!stream) {
        alert("Please start camera first");
        return;
    }

    const canvas = document.getElementById("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext("2d").drawImage(video, 0, 0);

    Tesseract.recognize(canvas, "hin+eng").then(({ data: { text } }) => {

        let lines = text
            .split("\n")
            .map(l => l.trim())
            .filter(l => l !== "");

        let name = "";

        for (let i = 0; i < lines.length; i++) {
            if (/‡§™‡•ç‡§∞‡§§‡§ø/.test(lines[i]) && lines[i + 1]) {
                // Extract only English words from next line
                let englishWords = lines[i + 1].match(/[A-Z]+/gi);
                if (englishWords) {
                    name = englishWords.slice(0, 2).join(" ");
                }
                break;
            }
        }

        // Extract 6-digit pincode
        let pinMatch = text.match(/\b\d{6}\b/);
        let pincode = pinMatch ? pinMatch[0] : "";

        addRow(name, pincode);
    });
}

// Add row to table
function addRow(name, pincode) {
    const tbody = document.getElementById("tableBody");
    const row = document.createElement("tr");

    row.innerHTML = `
        <td>${slNo++}</td>
        <td>${name}</td>
        <td>${pincode}</td>
    `;

    tbody.appendChild(row);
}
</script>

</body>
</html>
